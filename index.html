<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoScholar India - The Ultimate Scholarship Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Base Styling & Font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #030712; /* gray-950 */
            color: #d1d5db; /* gray-300 */
        }
        
        /* --- Animated Gradient Background --- */
        .main-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #4c1d95, #86198f, #9f1239, #4c1d95);
            background-size: 400% 400%;
            animation: gradient-flow 20s ease infinite;
            filter: blur(120px);
            opacity: 0.25;
            z-index: -1;
            will-change: background-position;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Glassmorphism Effect --- */
        .glass-panel {
            background: rgba(17, 24, 39, 0.6); /* gray-900 with opacity */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Animations & Transitions */
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .animate-fade-in-up { animation: fade-in-up 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        @keyframes card-fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .dynamic-field { animation: card-fade-in 0.4s ease-out forwards; }

        /* Scholarship Type Tags */
        .tag { @apply inline-block px-3 py-1 text-xs font-semibold rounded-full border; }
        .tag-government { @apply bg-purple-500/10 text-purple-300 border-purple-500/20; }
        .tag-private { @apply bg-pink-500/10 text-pink-300 border-pink-500/20; }
        
        /* --- Card Design --- */
        .result-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .result-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(216, 180, 254, 0.4); /* purple-300 with opacity */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.2), 0 8px 10px -6px rgb(0 0 0 / 0.2);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }
    </style>
</head>
<body class="font-sans">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 bg-gray-900/50 backdrop-blur-md flex items-center justify-center z-50 p-4">
        <div class="glass-panel p-10 rounded-2xl w-full max-w-md text-center transform transition-all animate-fade-in-up">
            <h2 class="text-3xl font-extrabold text-purple-300 mb-2 tracking-tighter">Welcome to GoScholar</h2>
            <p class="text-gray-400 mb-8">The future of scholarship hunting.</p>
            <div class="space-y-4">
                <button type="button" id="google-login-btn" class="w-full flex items-center justify-center bg-white text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition-all duration-300 shadow-lg transform hover:-translate-y-1 border border-gray-300">
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.022,35.421,44,30.038,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                    Sign in with Google
                </button>
                <div class="my-2 flex items-center">
                    <div class="flex-grow border-t border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-xs">OR</span>
                    <div class="flex-grow border-t border-gray-600"></div>
                </div>
                <button type="button" id="guest-login-btn" class="w-full bg-gray-700/50 text-gray-200 font-bold py-3 px-4 rounded-lg hover:bg-gray-600/50 transition-all duration-300 shadow-lg transform hover:-translate-y-1">
                    Continue as Guest
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application Content -->
    <div id="main-content" class="hidden main-container relative min-h-screen">
        <header class="glass-panel sticky top-0 z-40">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-100 tracking-tight">GoScholar India</h1>
                <div class="flex space-x-4 items-center">
                    <button id="tab-finder" class="px-3 py-1.5 text-sm font-medium rounded-md text-purple-300 bg-black/20 border border-purple-500/30">Finder</button>
                    <button id="tab-all" class="px-3 py-1.5 text-sm font-medium rounded-md text-gray-400 hover:bg-black/20 hover:text-gray-200">All Scholarships</button>
                </div>
            </div>
        </header>
        
        <main class="container mx-auto p-4 md:p-8">
            <!-- Finder Content -->
            <div id="finder-content">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-fuchsia-500 tracking-tighter">Find Your Future Scholarship</h2>
                    <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-400">Fill in your details and let our smart engine find the perfect opportunities for you.</p>
                </div>

                <div class="glass-panel p-6 md:p-8 rounded-2xl mb-12">
                     <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-200">Your Profile</h2>
                        <button id="clear-form-btn" type="button" title="Clear Form" class="text-gray-400 hover:text-fuchsia-400 transition-colors">
                            <i data-lucide="rotate-cw" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <form id="scholarship-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Panel 1: Academics -->
                            <div>
                                <h3 class="text-lg font-bold text-purple-400 mb-4">Academic Details</h3>
                                <div id="academic-fields-container" class="space-y-4"></div>
                            </div>
                            <!-- Panel 2: Personal & Financial -->
                            <div>
                                <h3 class="text-lg font-bold text-purple-400 mb-4">Personal & Financial</h3>
                                <div class="space-y-4">
                                    <div><label for="category" class="block text-sm font-medium text-gray-300">Caste Category</label><select id="category" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-800/50 text-gray-200 border-gray-600 focus:outline-none focus:ring-fuchsia-500 focus:border-fuchsia-500 sm:text-sm rounded-md"><option value="GENERAL">General</option><option value="OBC">OBC</option><option value="SC">SC</option><option value="ST">ST</option><option value="MINORITY">Minority</option></select></div>
                                    <div><label for="income" class="block text-sm font-medium text-gray-300">Annual Family Income (₹)</label><input type="number" id="income" placeholder="e.g., 80000" class="mt-1 block w-full bg-gray-800/50 text-gray-200 border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-fuchsia-500 focus:border-fuchsia-500"></div>
                                    <div><label for="state" class="block text-sm font-medium text-gray-300">State of Domicile</label><select id="state" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-800/50 text-gray-200 border-gray-600 focus:outline-none focus:ring-fuchsia-500 focus:border-fuchsia-500 sm:text-sm rounded-md"><option value="">Select your State</option></select></div>
                                </div>
                            </div>
                            <!-- Panel 3: Special Categories -->
                            <div>
                                <h3 class="text-lg font-bold text-purple-400 mb-4">Special Categories</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center"><input type="checkbox" id="exServiceman" class="h-4 w-4 text-fuchsia-500 bg-gray-700 border-gray-600 rounded focus:ring-fuchsia-500"><span class="ml-3 text-sm text-gray-300">Ward of Ex-Servicemen</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="farmer" class="h-4 w-4 text-fuchsia-500 bg-gray-700 border-gray-600 rounded focus:ring-fuchsia-500"><span class="ml-3 text-sm text-gray-300">Agricultural Background</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="disabled" class="h-4 w-4 text-fuchsia-500 bg-gray-700 border-gray-600 rounded focus:ring-fuchsia-500"><span class="ml-3 text-sm text-gray-300">Person with Disability (PwD)</span></label>
                                </div>
                                <div class="mt-6">
                                    <label class="block text-base font-semibold text-gray-300 mb-2">Scholarship Type</label>
                                    <div class="flex items-center space-x-4 bg-gray-800/50 p-1 rounded-lg">
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="All" class="sr-only peer" checked><span class="block px-4 py-2 rounded-md cursor-pointer text-sm font-medium peer-checked:bg-fuchsia-600 text-gray-300 peer-checked:text-white transition">All</span></label>
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="Government" class="sr-only peer"><span class="block px-4 py-2 rounded-md cursor-pointer text-sm font-medium peer-checked:bg-fuchsia-600 text-gray-300 peer-checked:text-white transition">Govt</span></label>
                                        <label class="flex-1 text-center"><input type="radio" name="scholarshipType" value="Private" class="sr-only peer"><span class="block px-4 py-2 rounded-md cursor-pointer text-sm font-medium peer-checked:bg-fuchsia-600 text-gray-300 peer-checked:text-white transition">Private</span></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>


                <div class="border-t border-gray-700 pt-8">
                    <h2 id="results-title" class="text-3xl font-bold text-gray-200 mb-6 text-center">Your Scholarship Matches</h2>
                    <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                </div>
            </div>

            <!-- All Scholarships Content -->
            <div id="all-scholarships-content" class="hidden">
                <div class="mb-6"><h2 class="text-3xl font-bold text-gray-200">All Available Scholarships</h2><p class="text-gray-400 mt-1">Browse and search our entire database of scholarships.</p></div>
                <div class="relative mb-6"><input type="text" id="all-scholarships-search" placeholder="Search by name, portal, or description..." class="w-full pl-10 pr-4 py-3 bg-gray-800/50 text-gray-200 border-gray-600 rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 transition-shadow"><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i data-lucide="search" class="w-5 h-5 text-gray-500"></i></div></div>
                <div id="all-scholarships-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>
        </main>
    </div>

    <script>
        // --- STATES LIST ---
        const states = ["Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal", "Andaman and Nicobar Islands", "Chandigarh", "Dadra and Nagar Haveli and Daman and Diu", "Delhi", "Jammu and Kashmir", "Ladakh", "Lakshadweep", "Puducherry"];

        // --- UTILITY: DEBOUNCE FUNCTION ---
        function debounce(func, delay = 400) { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => { func.apply(this, args); }, delay); }; }
        
        // --- GLOBAL SCOPE FOR SCHOLARSHIPS ---
        let scholarships = [];

        // --- SCRIPT LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const guestLoginBtn = document.getElementById('guest-login-btn');
            const googleLoginBtn = document.getElementById('google-login-btn');

            const performLogin = () => {
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                initializeApp(); 
            };

            guestLoginBtn.addEventListener('click', performLogin);
            
            googleLoginBtn.addEventListener('click', () => {
                alert("Sign in with Google is coming soon! For now, please continue as a guest.");
            });
        });

        async function initializeApp() {
            // --- NEW: Fetch scholarships from your live backend FIRST ---
            try {
                // !!! IMPORTANT: REPLACE THIS URL with the one Wrangler gave you !!!
                const response = await fetch("https://goscholar-backend.propane.workers.dev");
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const cloudScholarships = await response.json();
                scholarships = cloudScholarships; 
            } catch (error) {
                console.error("Failed to fetch scholarships:", error);
                alert("CRITICAL ERROR: Could not load the scholarship database from the server. Please check the developer console (F12) for more details.");
                scholarships = []; // Fallback to an empty list on error
            }
        
            // --- All other setup functions are now called AFTER the data is loaded ---
            const stateSelect = document.getElementById('state');
            if (stateSelect.options.length <= 1) { states.forEach(state => stateSelect.add(new Option(state, state))); }
            const form = document.getElementById('scholarship-form');
            
            const debouncedFind = debounce(findScholarships);
            form.addEventListener('input', (e) => {
                if (e.target.type === 'number') {
                    validateNumberInput(e.target);
                }
                if(e.target.id === 'studyLevel' || e.target.id === 'fieldOfStudy') {
                    updateAcademicFields();
                }
                debouncedFind();
            });

            document.getElementById('clear-form-btn').addEventListener('click', () => {
                form.reset();
                updateAcademicFields();
                form.dispatchEvent(new Event('input')); 
            });
            
            setupTabs();
            updateAcademicFields(); 
            findScholarships();
            displayAllScholarships(); 
            lucide.createIcons();
        }
        
        function validateNumberInput(input) {
            const id = input.id;
            let value = parseFloat(input.value);
            let max = null;
            let message = null;

            if (id === 'cgpa') {
                max = 10.0;
                message = "CGPA cannot exceed 10.0";
            } else if (id.includes('marks')) {
                max = 100;
                message = "Percentage cannot exceed 100";
            }
            
            if (max !== null && value > max) {
                input.value = max;
                const parentDiv = input.parentElement;
                let errorMsg = parentDiv.querySelector('.error-message');
                if (!errorMsg) {
                    errorMsg = document.createElement('p');
                    errorMsg.className = 'text-red-400 text-xs mt-1 error-message';
                    parentDiv.appendChild(errorMsg);
                }
                errorMsg.textContent = message;
                setTimeout(() => {
                    errorMsg.remove();
                }, 3000);
            }
        }

        function updateAcademicFields() {
            const container = document.getElementById('academic-fields-container');
            let currentLevel = container.querySelector('#studyLevel')?.value || 'UG';
            let currentField = container.querySelector('#fieldOfStudy')?.value;

            container.innerHTML = ''; 

            const levelSelectHTML = `<div class="dynamic-field"><label for="studyLevel" class="block text-sm font-medium text-gray-300">Current Level of Study</label><select id="studyLevel" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-800/50 text-gray-200 border-gray-600 focus:outline-none focus:ring-fuchsia-500 focus:border-fuchsia-500 sm:text-sm rounded-md">
                <option value="PreMatric">Pre-Matric (Nursery-10)</option>
                <option value="PostMatric">Post-Matric (11-12)</option>
                <option value="UG">Undergraduate (UG)</option>
                <option value="PG">Postgraduate (PG)</option>
                <option value="Doctoral">Doctoral (Ph.D.)</option>
                <option value="PostDoctoral">Post-Doctoral / Research</option>
            </select></div>`;
            container.insertAdjacentHTML('beforeend', levelSelectHTML);
            const levelSelect = container.querySelector('#studyLevel');
            levelSelect.value = currentLevel;

            const fieldGroups = {
                UG: {
                    "General Education": ["BA", "BSc", "B.Com", "Humanities"],
                    "Technical / Professional": ["B.E/B.Tech", "Architecture", "Design"],
                    "Medical & Health": ["MBBS", "BDS", "Nursing", "Pharmacy", "Ayurveda", "Homeopathy"],
                    "Management / IT": ["BBA", "BCA", "Computer Science"],
                    "Agriculture & Allied": ["B.Sc. Agri", "Veterinary", "Fisheries"],
                    "Law & Education": ["LLB", "B.Ed"]
                },
                PG: {
                    "General Education": ["MA", "MSc", "M.Com"],
                    "Technical / Professional": ["M.Tech"],
                    "Medical & Health": ["MD", "MS"],
                    "Management / IT": ["MBA", "MCA", "Data Science"],
                    "Agriculture & Allied": ["M.Sc. Agri"],
                    "Law & Education": ["LLM", "M.Ed"]
                },
                Doctoral: { "Research Fields": ["Ph.D.", "M.Phil"] },
                PostDoctoral: { "Research Fields": ["Post-Doctoral"] }
            };

            let fieldOptions = '';
            let fieldDisabled = false;
            
            if (currentLevel === 'PreMatric') {
                fieldDisabled = true;
                fieldOptions = `<option value="General">General</option>`;
            } else if (currentLevel === 'PostMatric') {
                fieldOptions = `<option value="Science">Science</option><option value="Commerce">Commerce</option><option value="Arts">Arts</option>`;
            } else if (fieldGroups[currentLevel]) {
                 const relevantGroups = fieldGroups[currentLevel];
                 for (const group in relevantGroups) {
                     fieldOptions += `<optgroup label="${group}">`;
                     relevantGroups[group].forEach(opt => fieldOptions += `<option value="${opt}">${opt}</option>`);
                     fieldOptions += `</optgroup>`;
                 }
            }

            const fieldSelectHTML = `<div class="dynamic-field"><label for="fieldOfStudy" class="block text-sm font-medium text-gray-300">Field of Study / Stream</label><select id="fieldOfStudy" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-800/50 text-gray-200 border-gray-600 focus:outline-none focus:ring-fuchsia-500 focus:border-fuchsia-500 sm:text-sm rounded-md" ${fieldDisabled ? 'disabled' : ''}>${fieldOptions}</select></div>`;
            container.insertAdjacentHTML('beforeend', fieldSelectHTML);
            const fieldSelect = container.querySelector('#fieldOfStudy');
            if (currentField && Array.from(fieldSelect.options).some(o => o.value === currentField)) {
                fieldSelect.value = currentField;
            } else if (!fieldDisabled) {
                fieldSelect.selectedIndex = 0;
            }
            currentField = fieldSelect.value;

            const createInputHTML = (id, label, type = 'number', placeholder = 'e.g., 85') => `<div class="dynamic-field"><label for="${id}" class="block text-sm font-medium text-gray-300">${label}</label><input type="${type}" id="${id}" min="0" ${type === 'number' && id !== 'cgpa' ? 'max="100"' : ''} ${id === 'cgpa' ? 'max="10" step="0.1"' : ''} placeholder="${placeholder}" class="mt-1 block w-full bg-gray-800/50 text-gray-200 border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-fuchsia-500 focus:border-fuchsia-500"></div>`;
            const createSelectHTML = (id, label, options) => `<div class="dynamic-field"><label for="${id}" class="block text-sm font-medium text-gray-300">${label}</label><select id="${id}" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-800/50 text-gray-200 border-gray-600 focus:outline-none focus:ring-fuchsia-500 focus:border-fuchsia-500 sm:text-sm rounded-md">${options}</select></div>`;

            let specificFieldsHTML = '';
            
            if (['PostMatric', 'UG', 'PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) {
                specificFieldsHTML += createInputHTML('marks10', '10th Percentage (%)');
            }
            if (['UG', 'PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) {
                specificFieldsHTML += createInputHTML('marks12', '12th Percentage (%)');
            }
            if (['PG', 'Doctoral', 'PostDoctoral'].includes(currentLevel)) {
                specificFieldsHTML += createInputHTML('marksUG', 'Undergraduate CGPA / Percentage');
            }
             if (['Doctoral', 'PostDoctoral'].includes(currentLevel)) {
                specificFieldsHTML += createInputHTML('marksPG', 'Postgraduate Percentage (%)');
            }
            
            if (currentLevel === 'PreMatric') {
                const classOptions = Array.from({length: 10}, (_, i) => `<option value="${i + 1}">${i + 1}</option>`).join('');
                specificFieldsHTML += createSelectHTML('currentClass', 'Current Class', classOptions);
                specificFieldsHTML += createInputHTML('marksPrev', 'Previous Class Percentage (%)');
            } else if (currentLevel === 'UG') {
                const technicalStreams = ["B.E/B.Tech"];
                if (technicalStreams.includes(currentField)) {
                    const semOptions = Array.from({length: 8}, (_, i) => `<option value="${i + 1}">Semester ${i + 1}</option>`).join('');
                    specificFieldsHTML += createSelectHTML('currentSemester', 'Current Semester', semOptions);
                    specificFieldsHTML += createInputHTML('cgpa', 'Previous Semester CGPA (out of 10)', 'number', 'e.g., 8.5');
                }
            }

            container.insertAdjacentHTML('beforeend', specificFieldsHTML);
        }

        function setupTabs() {
            const tabFinder = document.getElementById('tab-finder');
            const tabAll = document.getElementById('tab-all');
            const finderContent = document.getElementById('finder-content');
            const allScholarshipsContent = document.getElementById('all-scholarships-content');
            tabFinder.addEventListener('click', () => {
                tabFinder.classList.add('bg-black/20', 'text-[var(--accent-gold)]', 'border-[var(--accent-gold)]/50');
                tabFinder.classList.remove('text-gray-400', 'hover:bg-black/20', 'hover:text-gray-200');
                tabAll.classList.add('text-gray-400', 'hover:bg-black/20', 'hover:text-gray-200');
                tabAll.classList.remove('bg-black/20', 'text-[var(--accent-gold)]', 'border-[var(--accent-gold)]/50');
                finderContent.style.display = 'block';
                allScholarshipsContent.style.display = 'none';
            });
            tabAll.addEventListener('click', () => {
                tabAll.classList.add('bg-black/20', 'text-[var(--accent-gold)]', 'border-[var(--accent-gold)]/50');
                tabAll.classList.remove('text-gray-400', 'hover:bg-black/20', 'hover:text-gray-200');
                tabFinder.classList.add('text-gray-400', 'hover:bg-black/20', 'hover:text-gray-200');
                tabFinder.classList.remove('bg-black/20', 'text-[var(--accent-gold)]', 'border-[var(--accent-gold)]/50');
                allScholarshipsContent.style.display = 'block';
                finderContent.style.display = 'none';
            });
            const searchInput = document.getElementById('all-scholarships-search');
            searchInput.addEventListener('input', debounce(() => displayAllScholarships(searchInput.value), 300));
            allScholarshipsContent.style.display = 'none';
        }

        function calculateMatchScore(scholarship, student) {
            const e = scholarship.eligibility;
            
            if (e.level && !e.level.includes(student.level)) return 0;
            if (student.scholarshipType !== 'All' && scholarship.type !== student.scholarshipType) return 0;
            if (e.income && student.income > 0 && e.income < student.income) return 0;
            if (e.category && !e.category.includes(student.category)) return 0;
            if (e.stream && !e.stream.includes(student.stream) && !e.stream.includes("All")) return 0;
            if (e.minClass && student.currentClass > 0 && e.minClass > student.currentClass) return 0;
            if (e.maxClass && student.currentClass > 0 && e.maxClass < student.currentClass) return 0;
            if (e.minMarksPrev && student.marksPrev > 0 && e.minMarksPrev > student.marksPrev) return 0;
            if (e.minMarks10 && student.marks10 > 0 && e.minMarks10 > student.marks10) return 0;
            if (e.minMarks12 && student.marks12 > 0 && e.minMarks12 > student.marks12) return 0;
            if (e.minMarksUG && student.marksUG > 0 && e.minMarksUG > student.marksUG) return 0;
            if (e.minMarksPG && student.marksPG > 0 && e.minMarksPG > student.marksPG) return 0;
            if (e.minCGPA && student.cgpa > 0 && e.minCGPA > student.cgpa) return 0;
            if (e.minSemester && student.currentSemester > 0 && e.minSemester > student.currentSemester) return 0;
            if (e.domicile && student.domicile && !e.domicile.includes(student.domicile)) return 0;
            if (e.isDisabled && !student.isDisabled) return 0;
            if (e.isExServiceman && !student.isExServiceman) return 0;
            if (e.isFarmer && !student.isFarmer) return 0;

            let score = 1;
            if (e.domicile && e.domicile.includes(student.domicile)) score += 5;
            if (e.stream && e.stream.includes(student.stream)) score += 5;
            if (e.isDisabled && student.isDisabled) score += 4;
            if (e.isExServiceman && student.isExServiceman) score += 4;
            if (e.isFarmer && student.isFarmer) score += 4;
            if (e.category && e.category.includes(student.category) && e.category.length === 1) score += 2;
            if (e.minMarks12 && student.marks12 > (e.minMarks12 + 15)) score += 2;
            if (e.minCGPA && student.cgpa > (e.minCGPA + 1.5)) score += 2;

            return score;
        }

        function findScholarships() {
            const student = {
                level: document.getElementById('studyLevel')?.value,
                stream: document.getElementById('fieldOfStudy')?.value,
                currentClass: parseInt(document.getElementById('currentClass')?.value, 10) || 0,
                currentSemester: parseInt(document.getElementById('currentSemester')?.value, 10) || 0,
                marksPrev: parseInt(document.getElementById('marksPrev')?.value, 10) || 0,
                marks10: parseInt(document.getElementById('marks10')?.value, 10) || 0,
                marks12: parseInt(document.getElementById('marks12')?.value, 10) || 0,
                marksUG: parseInt(document.getElementById('marksUG')?.value, 10) || 0,
                marksPG: parseInt(document.getElementById('marksPG')?.value, 10) || 0,
                cgpa: parseFloat(document.getElementById('cgpa')?.value) || 0,
                scholarshipType: document.querySelector('input[name="scholarshipType"]:checked')?.value || 'All',
                category: document.getElementById('category').value,
                income: parseInt(document.getElementById('income').value, 10) || 0,
                domicile: document.getElementById('state').value,
                isExServiceman: document.getElementById('exServiceman').checked,
                isFarmer: document.getElementById('farmer').checked,
                isDisabled: document.getElementById('disabled').checked
            };

            const scoredScholarships = scholarships
                .map(s => ({ ...s, matchScore: calculateMatchScore(s, student) }))
                .filter(s => s.matchScore > 0);
            
            scoredScholarships.sort((a, b) => b.matchScore - a.matchScore);

            displayResults(scoredScholarships, student);
        }

        function displayResults(results, student) {
            const container = document.getElementById('results-container');
            const title = document.getElementById('results-title');
            container.innerHTML = ''; 
            
            const hasRequiredInput = student.income > 0 || student.marksPrev > 0 || student.marks10 > 0 || student.marks12 > 0 || student.marksUG > 0 || student.marksPG > 0 || student.cgpa > 0;
            if (!hasRequiredInput) {
                title.innerHTML = 'Start by filling your details';
                container.innerHTML = `<div class="glass-panel p-8 rounded-2xl text-center h-full flex flex-col justify-center"><i data-lucide="edit-3" class="mx-auto h-16 w-16 text-purple-400" stroke-width="1"></i><h3 class="mt-4 text-xl font-semibold text-gray-200">Ready to find scholarships?</h3><p class="mt-1 text-gray-400">Please fill your academic and financial details to start.</p></div>`;
                lucide.createIcons();
                return;
            }
            
            title.innerHTML = `Showing <span class="text-[var(--accent-gold)]">${results.length}</span> Matching Scholarships`;

            if (results.length === 0) {
                container.innerHTML = `<div class="glass-panel p-8 rounded-2xl text-center result-card" style="animation: card-fade-in 0.5s ease-out forwards;"><i data-lucide="search-x" class="mx-auto h-12 w-12 text-red-400" stroke-width="1.5"></i><h3 class="mt-4 text-xl font-semibold text-gray-200">No Matching Scholarships Found</h3><p class="mt-1 text-gray-400">Based on the provided details, we couldn't find any direct matches. Try adjusting the criteria.</p></div>`;
                lucide.createIcons();
                return;
            }
            const maxScore = results.length > 0 ? results[0].matchScore : 0;
            results.forEach((s, index) => container.appendChild(createScholarshipCard(s, index, s.matchScore >= maxScore && maxScore > 5)));
            lucide.createIcons();
        }
        
        function createScholarshipCard(s, index, isTopMatch = false) {
            const card = document.createElement('div');
            card.className = 'relative glass-panel p-6 rounded-2xl result-card';
            card.style.animation = `card-fade-in 0.5s ease-out ${index * 100}ms forwards`;
            
            const typeClass = s.type.toLowerCase() === 'private' ? 'tag-private' : 'tag-government';
            const typeTag = `<span class="tag ${typeClass}">${s.type}</span>`;
            const topMatchBadge = isTopMatch ? `<div class="top-match-badge"><i data-lucide="star" class="inline-block w-3 h-3 -mt-0.5"></i> Top Match</div>` : '';

            const eligibilityItems = [];
            if(s.eligibility.stream && s.eligibility.stream[0] !== 'All') eligibilityItems.push(`<li>Stream: <strong>${s.eligibility.stream.join(', ')}</strong></li>`);
            if(s.eligibility.minClass && s.eligibility.maxClass) eligibilityItems.push(`<li>For Classes: <strong>${s.eligibility.minClass} - ${s.eligibility.maxClass}</strong></li>`);
            if(s.eligibility.category) eligibilityItems.push(`<li>Category: <strong>${s.eligibility.category.join(', ')}</strong></li>`);
            if(s.eligibility.income) eligibilityItems.push(`<li>Family Income below: <strong>₹${s.eligibility.income.toLocaleString('en-IN')}</strong></li>`);
            if(s.eligibility.minMarksPrev) eligibilityItems.push(`<li>Min Previous Class Marks: <strong>${s.eligibility.minMarksPrev}%</strong></li>`);
            if(s.eligibility.minMarks10) eligibilityItems.push(`<li>Min 10th Marks: <strong>${s.eligibility.minMarks10}%</strong></li>`);
            if(s.eligibility.minMarks12) eligibilityItems.push(`<li>Min 12th Marks: <strong>${s.eligibility.minMarks12}%</strong></li>`);
            if(s.eligibility.minMarksUG) eligibilityItems.push(`<li>Min UG Marks: <strong>${s.eligibility.minMarksUG}%</strong></li>`);
            if(s.eligibility.minMarksPG) eligibilityItems.push(`<li>Min PG Marks: <strong>${s.eligibility.minMarksPG}%</strong></li>`);
            if(s.eligibility.minCGPA) eligibilityItems.push(`<li>Min CGPA: <strong>${s.eligibility.minCGPA}</strong></li>`);
            if(s.eligibility.domicile) eligibilityItems.push(`<li>Domicile: <strong>${s.eligibility.domicile.join(', ')}</strong></li>`);

            card.innerHTML = `
                ${topMatchBadge}
                <div class="flex justify-between items-start"><h3 class="text-xl font-bold text-[var(--accent-gold)] pr-4">${s.name}</h3>${typeTag}</div>
                <p class="text-sm font-medium text-gray-400 mt-1 mb-3">Portal: ${s.portal}</p>
                <p class="text-gray-300 mb-4 text-sm">${s.description}</p>
                <div class="border-t border-gray-700 pt-4"><h4 class="font-semibold text-gray-200 mb-2">Key Eligibility:</h4><ul class="list-disc list-inside text-sm text-gray-300 space-y-1">
                    ${eligibilityItems.join('')}
                </ul></div>
                <div class="mt-5"><a href="${s.link}" target="_blank" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-[var(--bg-dark-maroon)] bg-[var(--accent-gold)] hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 focus:ring-offset-gray-800 transition-all transform hover:-translate-y-0.5">Visit Portal <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></a></div>`;
            return card;
        }
        
         function displayAllScholarships(searchText = "") {
            const container = document.getElementById('all-scholarships-list');
            container.innerHTML = '';
            const lowercasedSearch = searchText.toLowerCase();
            const filteredScholarships = scholarships.filter(s => s.name.toLowerCase().includes(lowercasedSearch) || s.portal.toLowerCase().includes(lowercasedSearch) || s.description.toLowerCase().includes(lowercasedSearch));
            if (filteredScholarships.length === 0) {
                 container.innerHTML = `<div class="md-col-span-2 xl-col-span-3 text-center py-10"><p class="text-gray-500">No scholarships found for "${searchText}"</p></div>`;
                 return;
            }
            filteredScholarships.forEach((s, index) => container.appendChild(createScholarshipCard(s, index)));
            lucide.createIcons();
        }
    </script>
</body>
</html>



